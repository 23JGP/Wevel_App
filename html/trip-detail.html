<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <link rel="stylesheet" href="../css/all.css" />
    <link rel="stylesheet" href="../css/receipt-japan.css" />
  </head>
  <body>
    <header>
      <div>
        <a href="../index.html" id="left-link"
          ><img src="../img/left.png" id="left"
        /></a>
        <p id="title">일본</p>
      </div>
      <div>
        <img src="../img/search.png" id="search" />
        <img src="../img/setting.png" id="setting" />
        <div id="setting-menu">
          <p id="folder-correction">폴더수정</p>
          <p id="folder-delete">폴더 삭제</p>
          <p id="delete-receipt">영수증 삭제</p>
        </div>
      </div>
    </header>

    <main>
      <div id="info-container">
        <div id="trip-info">
          <img id="flag-image" />
          <p id="trip-date">2024.01.06 ~ 01.28</p>
        </div>

        <div id="money-info">
          <div id="money-flex">
            <p id="spend-money">30,000</p>
            <p>/</p>
            <p id="money">100,000</p>
            <p>$</p>
          </div>

          <div id="money-bar">
            <div id="spend-bar"></div>
          </div>

          <div id="save-money">
            <p>남은 금액</p>
            <p id="remain-money">70,000</p>
            <p>$</p>
          </div>
        </div>
      </div>

      <hr />

      <div id="receipt-container">
        <div id="sort-box">
          <div id="sort-content">
            <p id="sort-title">항목</p>
            <p id="receipt-cnt">5</p>
          </div>

          <div id="sort-list">
            <p>전체</p>
            <p>오늘</p>
            <p>이번 주</p>
            <p>이번 달</p>
          </div>
        </div>

        <div id="receipt-box">
          <div class="money-box">
            <img src="../img/money-list.png" class="money-img" />
            <div>
              <p class="money-title">돈키호테</p>
              <p class="money-date">2024. 01. 16</p>
            </div>
            <p class="money-amount">3000 ¥</p>
          </div>

          <div class="money-box">
            <img src="../img/money-list.png" class="money-img" />
            <div>
              <p class="money-title">편의점</p>
              <p class="money-date">2024. 01. 16</p>
            </div>
            <p class="money-amount">1200 ¥</p>
          </div>

          <div class="money-box">
            <img src="../img/money-list.png" class="money-img" />
            <div>
              <p class="money-title">슈퍼</p>
              <p class="money-date">2024. 01. 16</p>
            </div>
            <p class="money-amount">2400 ¥</p>
          </div>

          <div class="money-box">
            <img src="../img/money-list.png" class="money-img" />
            <div>
              <p class="money-title">택시비</p>
              <p class="money-date">2024. 01. 16</p>
            </div>
            <p class="money-amount">600 ¥</p>
          </div>

          <div class="money-box">
            <img src="../img/money-list.png" class="money-img" />
            <div>
              <p class="money-title">편의점</p>
              <p class="money-date">2024. 01. 16</p>
            </div>
            <p class="money-amount">54 ¥</p>
          </div>
        </div>
      </div>
    </main>

    <script>
      document.addEventListener("DOMContentLoaded", function () {
        // URLSearchParams를 사용하여 URL에서 파라미터 추출
        const urlParams = new URLSearchParams(window.location.search);

        // tripId 파라미터 값 가져오기
        const tripId = urlParams.get("tripId");

        // API 호출
        fetch(`http://localhost:8085/api/trips/${tripId}`)
          .then((response) => response.json())
          .then((data) => {
            // 데이터 로드 후 처리
            console.log("API Response:", data);

            // 국가 이미지 설정
            let countryImage = ""; // 초기값 설정
            switch (data.country) {
              case "일본":
                countryImage = "flag-japen.png";
                break;
              case "미국":
                countryImage = "flag-usa.png";
                break;
              case "베트남":
                countryImage = "flag-vietnam.png";
                break;
              case "태국":
                countryImage = "flag-thailand.png";
                break;
              // 다른 국가에 대한 경우를 추가할 수 있음
              default:
                // 기본 이미지 설정
                countryImage = "default-trip.png";
            }

            // 소비한 금액 퍼센트로 반환
            const totalBudget = data.totalBudget;
            const spentAmount = data.spentAmount;
            const spentPercentage = (spentAmount / totalBudget) * 100;

            // 소비한 금액 바
            const spendBarElement = document.getElementById("spend-bar");
            spendBarElement.style.width = `${spentPercentage}%`;

            // 국가 이미지 요소에 반영
            const flagImageElement = document.getElementById("flag-image");
            flagImageElement.src = `../img/${countryImage}`;

            // 나머지 데이터를 HTML 요소에 반영
            const titleElement = document.getElementById("title");
            titleElement.textContent = data.tripName;

            const tripDateElement = document.getElementById("trip-date");
            tripDateElement.textContent = formatDate(
              data.startDate,
              data.endDate
            );

            const spendMoneyElement = document.getElementById("spend-money");
            spendMoneyElement.textContent = data.spentAmount.toLocaleString();

            const moneyElement = document.getElementById("money");
            moneyElement.textContent = data.totalBudget.toLocaleString();

            const remainMoneyElement = document.getElementById("remain-money");
            remainMoneyElement.textContent =
              data.remainingAmount.toLocaleString();
          })
          .catch((error) => {
            console.error("API Error:", error);
          });

        // 날짜 형식 변환 함수
        function formatDate(startDate, endDate) {
          const start = new Date(startDate);
          const end = new Date(endDate);
          const formattedStart = `${start.getFullYear()}.${
            start.getMonth() + 1
          }.${start.getDate()}`;
          const formattedEnd = `${end.getMonth() + 1}.${end.getDate()}`;
          return `${formattedStart} ~ ${formattedEnd}`;
        }

        // 국가에 따른 화폐 기호 반환 함수
        function getCurrencySymbol(country) {
          switch (country) {
            case "일본":
              return "¥";
            case "미국":
              return "$";
            case "베트남":
              return "₫";
            case "태국":
              return "฿";
            default:
              return "";
          }
        }
      });
    </script>
    <div id="overlay"></div>

    <div id="popup" style="display: none">
      <p id="popup-title">정말 삭제하시겠습니까?</p>
      <p id="popup-content">
        한번 삭제하신 정보는 복구할 수 없습니다.<br />정말 삭제하시겠습니까?
      </p>
      <div>
        <p id="popup-cancle">취소</p>
        <p id="popup-delete">삭제</p>
      </div>
    </div>

    <script src="../js/receipt-japan.js"></script>
  </body>
</html>
